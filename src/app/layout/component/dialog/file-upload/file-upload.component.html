<div class="mb-4">
    <label class="block mb-2 font-semibold">{{ label }}</label>

    <div class="flex gap-2 flex-wrap">
        <!-- Desktop: File upload -->
        <div class="hidden md:block w-full">
            <p-fileupload
                #fileUpload
                mode="advanced"
                [multiple]="multiple"
                [auto]="false"
                [showUploadButton]="showUploadButton"
                (onSelect)="onFileSelect($event)"
                chooseLabel="Добавить"
                (onRemove)="onRemoveWidget($event)"
                cancelLabel="Очистить"
                [maxFileSize]="maxFileSize"
                [accept]="accept"
            >
                <ng-template #content let-files let-uploadedFiles="uploadedFiles"
                             let-removeFileCallback="removeFileCallback"
                             let-removeUploadedFileCallback="removeUploadedFileCallback">
                    <div class="flex flex-col gap-8 pt-4">
                        @if (files?.length > 0) {
                            <div class="flex flex-col gap-2">
                                @for (file of files; track $index; let i = $index) {
                                    <div class="flex items-center gap-4 p-3 rounded-border border border-surface">
                                        <!-- Left: Icon or Image -->
                                        <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center">
                                            @if (isImageFile(file)) {
                                                <img role="presentation" [alt]="file.name" [src]="file.objectURL"
                                                     class="w-12 h-12 rounded object-contain" />
                                            } @else {
                                                <i [class]="getFileIcon(file)" class="text-3xl"></i>
                                            }
                                        </div>

                                        <!-- Middle: File name and size -->
                                        <div class="flex-1 min-w-0">
                                            <div class="font-semibold text-ellipsis whitespace-nowrap overflow-hidden">
                                                {{ file.name }}
                                            </div>
                                            <div class="text-sm text-color-secondary">{{ formatFileSize(file.size) }}
                                            </div>
                                        </div>

                                        <!-- Right: Remove button -->
                                        <div class="flex-shrink-0">
                                            <p-button icon="pi pi-times"
                                                      (click)="onRemoveTemplatingFile($event, file, removeFileCallback, i)"
                                                      [outlined]="true" [rounded]="true"
                                                      severity="danger" size="small" />
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </ng-template>
                <ng-template #empty>
                    <div class="flex items-center justify-center flex-col">
                        <i class="pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"></i>
                        <p class="mt-6 mb-0">Перетащите файл сюда.</p>
                    </div>
                </ng-template>
            </p-fileupload>
        </div>

        <!-- Mobile: Button only -->
        <div class="block md:hidden">
            <p-fileupload
                mode="basic"
                [multiple]="multiple"
                [auto]="false"
                [showUploadButton]="showUploadButton"
                chooseLabel="Выбрать файлы"
                (onSelect)="onFileSelect($event)"
                [maxFileSize]="maxFileSize"
                [accept]="accept"
            ></p-fileupload>
        </div>

        <!-- Clipboard paste button -->
        @if (enableClipboard) {
            <p-button
                label="Вставить из буфера обмена"
                icon="pi pi-clipboard"
                severity="secondary"
                [outlined]="true"
                (onClick)="pasteFromClipboard()"
                pTooltip="Ctrl+V или нажмите, чтобы вставить файл из буфера обмена"
            />
        }
    </div>

    @if (enableClipboard) {
        <div class="mt-2 text-sm text-color-secondary">
            <i class="pi pi-info-circle"></i> Вы можете вставить файл нажав Ctrl+V
        </div>
    }
</div>
