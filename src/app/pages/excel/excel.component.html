<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

    <div class="font-semibold text-3xl mb-4">"Ўзбекгидроэнерго" АЖ таркибидаги ГЭС ва сув омборларда содир бўлган умумий ҳолатлар тўғрисида маълумот</div>
<div class="card">
    <div class="flex justify-end">
        <p-button label="Excel" icon="pi pi-download" styleClass="p-button-success" (click)="exportCombinedToExcel()"></p-button>
    </div>
</div>
<div class="card">
    <div class="flex justify-end items-center mb-4">
        <div class="flex gap-2 text-end">
            <p-button label="Добавить" icon="pi pi-plus" (click)="showAddDialog2()"></p-button>
        </div>
    </div>

    <p-table [value]="allStudents2" dataKey="id" sortField="group" sortMode="single" (onSort)="onSort()" rowGroupMode="subheader" groupRowsBy="group" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>№</th>
                <th>Дата и время</th>
                <th>Наименование объекта</th>
                <th>Примечание</th>
                <th style="width: 5rem"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="groupheader" let-student>
            <tr pRowGroupHeader>
                <td colspan="5">
                    <span class="font-bold">{{ student.group }}</span>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-student>
            <tr>
                <td>{{ student.school }}</td>
                <td>{{ student.student }}</td>
                <td>{{ student.class }}</td>
                <td>{{ student.age }}</td>
                <td>
                    <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text" (click)="deleteStudent2(student)"></p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<div class="card">
    <div class="flex justify-end items-center mb-4">
        <div class="flex gap-2 text-end">
            <p-button label="Добавить" icon="pi pi-plus" (click)="showAddDialog()"></p-button>
        </div>
    </div>

    <p-table [value]="allStudents" dataKey="id" sortField="group" sortMode="single" (onSort)="onSort()" rowGroupMode="subheader" groupRowsBy="group" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>№</th>
                <th>Наименование ГЭСов и филиалов</th>
                <th>Дата и время происшествия</th>
                <th>Дата и время восстановления</th>
                <th>Короткое описание аварии</th>
                <th>Непроизведенная электроэнергия (тыс. кВт*ч)</th>
                <th>Количество холостого сброса воды (тыс. м3)</th>
                <th style="width: 5rem"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="groupheader" let-student>
            <tr pRowGroupHeader>
                <td colspan="5">
                    <span class="font-bold">{{ student.group }}</span>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-student>
            <tr>
                <td>{{ student.school }}</td>
                <td>{{ student.student }}</td>
                <td>{{ student.class }}</td>
                <td>{{ student.age }}</td>
                <td>
                    <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text" (click)="deleteStudent(student)"></p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>


<!-- Одно общее диалоговое окно для добавления ученика -->
<p-dialog header="Добавить нового ученика" [(visible)]="displayAddDialog" [modal]="true" [style]="{ width: '450px' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-col gap-4 p-4">
        <div class="flex flex-col gap-2">
            <label for="group">Группа</label>
            <p-select id="group" [options]="groups" [(ngModel)]="newStudent.group" [filter]="true" optionLabel="name" optionValue="name" placeholder="Выберите группу"></p-select>
        </div>
        <div class="flex flex-col gap-2">
            <label for="school">Школа</label>
            <input pInputText id="school" [(ngModel)]="newStudent.school" required autofocus />
        </div>
        <div class="flex flex-col gap-2">
            <label for="student">Ф.И.О. ученика</label>
            <input pInputText id="student" [(ngModel)]="newStudent.student" required />
        </div>
        <div class="flex flex-col gap-2">
            <label for="class">Класс</label>
            <input pInputText id="class" [(ngModel)]="newStudent.class" />
        </div>
        <div class="flex flex-col gap-2">
            <label for="age">Возраст</label>
            <input pInputText type="number" id="age" [(ngModel)]="newStudent.age" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Отмена" icon="pi pi-times" styleClass="p-button-text" (click)="displayAddDialog = false"></p-button>
        <p-button label="Сохранить" icon="pi pi-check" (click)="saveNewStudent()"></p-button>
    </ng-template>
</p-dialog>

<!-- Второе диалоговое окно для второй таблицы -->
<p-dialog header="Добавить нового ученика (Таблица 2)" [(visible)]="displayAddDialog2" [modal]="true" [style]="{ width: '450px' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-col gap-4 p-4">
        <div class="flex flex-col gap-2">
            <label for="group2">Группа</label>
            <p-select id="group2" [options]="groups" [(ngModel)]="newStudent2.group" [filter]="true" optionLabel="name" optionValue="name" placeholder="Выберите группу"></p-select>
        </div>
        <div class="flex flex-col gap-2">
            <label for="school2">Школа</label>
            <input pInputText id="school2" [(ngModel)]="newStudent2.school" required autofocus />
        </div>
        <div class="flex flex-col gap-2">
            <label for="student2">Ф.И.О. ученика</label>
            <input pInputText id="student2" [(ngModel)]="newStudent2.student" required />
        </div>
        <div class="flex flex-col gap-2">
            <label for="class2">Класс</label>
            <input pInputText id="class2" [(ngModel)]="newStudent2.class" />
        </div>
        <div class="flex flex-col gap-2">
            <label for="age2">Возраст</label>
            <input pInputText type="number" id="age2" [(ngModel)]="newStudent2.age" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Отмена" icon="pi pi-times" styleClass="p-button-text" (click)="displayAddDialog2 = false"></p-button>
        <p-button label="Сохранить" icon="pi pi-check" (click)="saveNewStudent2()"></p-button>
    </ng-template>
</p-dialog>

<!-- Третья таблица -->
<div class="card">
    <div class="flex justify-between items-center mb-4">
        <h5 class="font-semibold text-xl m-0">Информация об аварийных отключениях на малых ГЭС</h5>
        <div class="flex gap-2">
            <p-button label="Добавить" icon="pi pi-plus" (click)="showAddDialog3()"></p-button>
        </div>
    </div>
    <p-table [value]="allStudents3" dataKey="id" sortField="group" sortMode="single" (onSort)="onSort()" rowGroupMode="subheader" groupRowsBy="group" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>№</th>
                <th>Наименование ГЭСов и филиалов</th>
                <th>Дата и время происшествия</th>
                <th>Дата и время восстановления</th>
                <th>Короткое описание аварии</th>
                <th>Непроизведенная электроэнергия (тыс. кВт*ч)</th>
                <th>Количество холостого сброса воды (тыс. м3)</th>
                <th style="width: 5rem"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="groupheader" let-student>
            <tr pRowGroupHeader>
                <td colspan="8">
                    <span class="font-bold">{{ student.group }}</span>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-student>
            <tr>
                <td>{{ student.school }}</td>
                <td>{{ student.student }}</td>
                <td>{{ student.class }}</td>
                <td>{{ student.age }}</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>
                    <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text" (click)="deleteStudent3(student)"></p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Третье диалоговое окно для третьей таблицы -->
<p-dialog header="Добавить нового ученика (Таблица 3)" [(visible)]="displayAddDialog3" [modal]="true" [style]="{ width: '450px' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-col gap-4 p-4">
        <div class="flex flex-col gap-2">
            <label for="group3">Группа</label>
            <p-select id="group3" [options]="groups" [(ngModel)]="newStudent3.group" [filter]="true" optionLabel="name" optionValue="name" placeholder="Выберите группу"></p-select>
        </div>
        <div class="flex flex-col gap-2">
            <label for="school3">Школа</label>
            <input pInputText id="school3" [(ngModel)]="newStudent3.school" required autofocus />
        </div>
        <div class="flex flex-col gap-2">
            <label for="student3">Ф.И.О. ученика</label>
            <input pInputText id="student3" [(ngModel)]="newStudent3.student" required />
        </div>
        <div class="flex flex-col gap-2">
            <label for="class3">Класс</label>
            <input pInputText id="class3" [(ngModel)]="newStudent3.class" />
        </div>
        <div class="flex flex-col gap-2">
            <label for="age3">Возраст</label>
            <input pInputText type="number" id="age3" [(ngModel)]="newStudent3.age" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Отмена" icon="pi pi-times" styleClass="p-button-text" (click)="displayAddDialog3 = false"></p-button>
        <p-button label="Сохранить" icon="pi pi-check" (click)="saveNewStudent3()"></p-button>
    </ng-template>
</p-dialog>
