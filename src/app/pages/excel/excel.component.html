<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<!-- Третья таблица -->
<div class="card">
    <div class="flex flex-col gap-4 mb-4">
        <h5 class="text-xl m-0">Информация об аварийных отключениях ГЭС</h5>
        <div class="flex gap-2">
            <p-button label="Добавить" icon="pi pi-plus" (click)="showAddDialog()"></p-button>
            <p-button label="Excel" icon="pi pi-download" styleClass="p-button-success" (click)="exportToExcel()"></p-button>
        </div>
    </div>
    <p-table [value]="shutdowns" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>№</th>
                <th>Наименование ГЭСов и филиалов</th>
                <th>Дата и время происшествия</th>
                <th>Дата и время восстановления</th>
                <th>Короткое описание аварии</th>
                <th>Непроизведенная электроэнергия (тыс. кВт*ч)</th>
                <th>Количество холостого сброса воды (тыс. м3)</th>
                <th style="width: 5rem"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-entry>
            <tr>
                <td>{{ entry.id }}</td>
                <td>{{ entry.organization }}</td>
                <td>{{ entry.event_date }}</td>
                <td>{{ entry.recovery_date }}</td>
                <td>{{ entry.description }}</td>
                <td>{{ entry.lost_power }}</td>
                <td>{{ entry.idle_discharge }}</td>
                <td>
                    <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text" (click)="deleteEntry(entry)"></p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Диалоговое окно для добавления записи -->
<p-dialog header="Добавить запись об отключении" [(visible)]="displayAddDialog" [modal]="true" [style]="{ width: '450px' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-col gap-4 p-4">
        <div class="flex flex-col gap-2">
            <label for="organization">Наименование объекта</label>
            <p-select [options]="organizations" [(ngModel)]="newEntry.organization" placeholder="Выберите объект" optionLabel="name" optionValue="name" [filter]="true" [group]="true" [appendTo]="'body'" class="w-full">
                <ng-template let-group #group> <div class="flex items-center"> <span>{{ group.name }}</span> </div> </ng-template>
            </p-select>
        </div>
        <div class="flex flex-col gap-2">
            <label for="event_date">Дата и время происшествия</label>
            <p-date-picker id="event_date" [(ngModel)]="newEntry.event_date" [showTime]="true" hourFormat="24" dateFormat="yy-mm-dd"  inputId="event_time" [appendTo]="'body'"></p-date-picker>
        </div>
        <div class="flex flex-col gap-2">
            <label for="recovery_date">Дата и время восстановления</label>
            <p-date-picker id="recovery_date" [(ngModel)]="newEntry.recovery_date" [showTime]="true" hourFormat="24" dateFormat="yy-mm-dd"  inputId="recovery_time" [appendTo]="'body'"></p-date-picker>
        </div>
        <div class="flex flex-col gap-2">
            <label for="description">Короткое описание аварии</label>
            <input pInputText id="description" [(ngModel)]="newEntry.description" required />
        </div>
        <div class="flex flex-col gap-2">
            <label for="lost_power">Непроизведенная электроэнергия (тыс. кВт*ч)</label>
            <input pInputText type="number" id="lost_power" [(ngModel)]="newEntry.lost_power" />
        </div>
        <div class="flex flex-col gap-2">
            <label for="idle_discharge">Количество холостого сброса воды (тыс. м3)</label>
            <input pInputText type="number" id="idle_discharge" [(ngModel)]="newEntry.idle_discharge" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Отмена" icon="pi pi-times" styleClass="p-button-text" (click)="displayAddDialog = false"></p-button>
        <p-button label="Сохранить" icon="pi pi-check" (click)="saveNewEntry()"></p-button>
    </ng-template>
</p-dialog>
