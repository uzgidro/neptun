<div class="financial-dashboard">
    <div class="dashboard-header">
        <div class="header-content">
            <h1>{{ 'FINANCIAL_BLOCK.DASHBOARD.TITLE' | translate }}</h1>
            <p class="subtitle">{{ 'FINANCIAL_BLOCK.DASHBOARD.SUBTITLE' | translate }}</p>
        </div>
        <div class="last-updated" *ngIf="dashboardData?.lastUpdated">
            <i class="pi pi-clock"></i>
            <span>{{ 'DASHBOARD.LAST_UPDATED' | translate }}: {{ dashboardData!.lastUpdated | date:'dd.MM.yyyy HH:mm' }}</span>
        </div>
    </div>

    <div class="summary-cards">
        <div class="summary-card income">
            <div class="card-icon">
                <i class="pi pi-arrow-down"></i>
            </div>
            <div class="card-content">
                <span class="label">{{ 'FINANCIAL_BLOCK.DASHBOARD.TOTAL_INCOME' | translate }}</span>
                <span class="value">{{ formatCurrency(totalIncome) }}</span>
            </div>
        </div>

        <div class="summary-card expenses">
            <div class="card-icon">
                <i class="pi pi-arrow-up"></i>
            </div>
            <div class="card-content">
                <span class="label">{{ 'FINANCIAL_BLOCK.DASHBOARD.TOTAL_EXPENSES' | translate }}</span>
                <span class="value">{{ formatCurrency(totalExpenses) }}</span>
            </div>
        </div>

        <div class="summary-card balance" [ngClass]="getBalanceClass()">
            <div class="card-icon">
                <i class="pi pi-wallet"></i>
            </div>
            <div class="card-content">
                <span class="label">{{ 'FINANCIAL_BLOCK.DASHBOARD.BALANCE' | translate }}</span>
                <span class="value">{{ formatCurrency(netBalance) }}</span>
            </div>
        </div>

        <div class="summary-card kpi">
            <div class="card-icon">
                <i class="pi pi-chart-bar"></i>
            </div>
            <div class="card-content">
                <span class="label">{{ 'FINANCIAL_BLOCK.DASHBOARD.KPI_PERFORMANCE' | translate }}</span>
                <div class="kpi-progress">
                    <p-progressBar
                        [value]="getKpiProgress()"
                        [showValue]="true"
                        [style]="{ height: '24px' }"
                        [color]="getKpiColor()">
                    </p-progressBar>
                </div>
            </div>
        </div>
    </div>

    <div class="charts-section">
        <div class="chart-card">
            <h3>{{ 'FINANCIAL_BLOCK.DASHBOARD.INCOME_VS_EXPENSES' | translate }}</h3>
            <div class="chart-container">
                <p-chart
                    type="doughnut"
                    [data]="overviewChartData"
                    [options]="overviewChartOptions"
                    [style]="{ width: '100%', height: '280px' }">
                </p-chart>
            </div>
        </div>

        <div class="chart-card">
            <h3>{{ 'FINANCIAL_BLOCK.DASHBOARD.EXPENSE_STRUCTURE' | translate }}</h3>
            <div class="chart-container">
                <p-chart
                    type="pie"
                    [data]="expensesChartData"
                    [options]="expensesChartOptions"
                    [style]="{ width: '100%', height: '280px' }">
                </p-chart>
            </div>
        </div>

        <div class="chart-card wide">
            <h3>{{ 'FINANCIAL_BLOCK.DASHBOARD.MONTHLY_DYNAMICS' | translate }}</h3>
            <div class="chart-container">
                <p-chart
                    type="bar"
                    [data]="cashFlowChartData"
                    [options]="cashFlowChartOptions"
                    [style]="{ width: '100%', height: '280px' }">
                </p-chart>
            </div>
        </div>
    </div>

    <div class="modules-section">
        <h2>{{ 'FINANCIAL_BLOCK.DASHBOARD.MODULES' | translate }}</h2>
        <p class="section-subtitle">{{ 'FINANCIAL_BLOCK.DASHBOARD.MODULES_HINT' | translate }}</p>

        <div class="modules-grid">
            <div
                *ngFor="let card of moduleCards"
                class="module-card"
                [style.--card-color]="card.color"
                (click)="navigateToModule(card.route)"
                [pTooltip]="'FINANCIAL_BLOCK.DASHBOARD.GO_TO_MODULE' | translate"
                tooltipPosition="top">

                <div class="card-header">
                    <div class="icon-wrapper" [style.background]="card.color">
                        <i [class]="card.icon"></i>
                    </div>
                    <h4>{{ card.title }}</h4>
                    <i class="pi pi-arrow-right navigate-icon"></i>
                </div>

                <p-divider></p-divider>

                <div class="metrics-list">
                    <div *ngFor="let metric of card.metrics" class="metric-item">
                        <span class="metric-label">{{ metric.label }}</span>
                        <p-tag
                            [value]="formatMetricValue(metric)"
                            [severity]="getMetricSeverity(metric.color)">
                        </p-tag>
                    </div>
                </div>

                <div class="card-footer">
                    <p-button
                        [label]="'FINANCIAL_BLOCK.DASHBOARD.DETAILS' | translate"
                        icon="pi pi-external-link"
                        [text]="true"
                        size="small"
                        (click)="navigateToModule(card.route); $event.stopPropagation()">
                    </p-button>
                </div>
            </div>
        </div>
    </div>
</div>
