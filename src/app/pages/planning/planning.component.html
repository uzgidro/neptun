<div class="card">
    <div class="flex justify-between items-center mb-4">
        <h5 class="font-semibold text-xl m-0">Планирование событий</h5>
        @if (authService.isAssistant()) {
            <p-button label="Добавить событие" icon="pi pi-plus" (click)="showAddDialog()"></p-button>
        }
    </div>

    <p-table [value]="events()" [paginator]="true" [rows]="10" sortField="date" [sortOrder]="-1">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5rem"></th>
                <th>Название</th>
                <th>Тип</th>
                <th>Дата и время</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-event>
            <tr>
                <td><i class="pi text-xl" [ngClass]="getIconClass(event.type)"></i></td>
                <td>{{ event.title }}</td>
                <td>{{ event.type }}</td>
                <td>{{ event.date | date: 'HH:mm dd.MM.yyyy' }}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog header="Добавить новое событие" [(visible)]="displayAddDialog" [modal]="true" [style]="{width: '450px'}" [draggable]="false" [resizable]="false">
    <div class="flex flex-col gap-4 p-4">
        <div class="flex flex-col gap-2">
            <label for="type">Тип события</label>
<!--            <p-dropdown id="type" [options]="eventTypes" [(ngModel)]="newEvent.type"></p-dropdown>-->
        </div>
        <app-input-text
            label="Название события"
            formControlName="responsible_name"
            [submitted]="submitted"
            errorMessage="Укажите название">
        </app-input-text>

        <app-date-picker
            label="Дата события"
            formControlName="incident_time"
            [submitted]="submitted"
            errorMessage="Укажите дату">
        </app-date-picker>

        <app-select
            label="Ответственный"
            formControlName="responsible_contact_id"
            [items]="contacts"
            [loading]="contactsLoading"
            [submitted]="submitted"
            errorMessage="Выберите ответственного">
        </app-select>

        <app-select
            label="Организация"
            formControlName="responsible_contact_id"
            [items]="contacts"
            [loading]="contactsLoading"
            [submitted]="submitted"
            errorMessage="Выберите ответственного">
        </app-select>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Отмена" icon="pi pi-times" styleClass="p-button-text" (click)="displayAddDialog=false"></p-button>
        <p-button label="Сохранить" icon="pi pi-check" (click)="saveNewEvent()"></p-button>
    </ng-template>
</p-dialog>
