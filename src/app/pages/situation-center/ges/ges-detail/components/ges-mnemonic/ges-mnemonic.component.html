<div class="mnemonic-container">
    @if (nodes.length > 0) {
        <svg
            class="mnemonic-svg"
            viewBox="0 0 450 350"
            preserveAspectRatio="xMidYMid meet">
            <!-- Background grid -->
            <defs>
                <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                    <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#e5e7eb" stroke-width="0.5" />
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid)" />

            <!-- Connection lines -->
            @for (node of nodes; track node.id; let i = $index) {
                @if (i > 0) {
                    <line
                        [attr.x1]="nodes[i-1].x + 20"
                        [attr.y1]="nodes[i-1].y + 20"
                        [attr.x2]="node.x + 20"
                        [attr.y2]="node.y + 20"
                        stroke="#cbd5e1"
                        stroke-width="2"
                        stroke-dasharray="5,5" />
                }
            }

            <!-- Nodes -->
            @for (node of nodes; track node.id) {
                <g
                    class="node-group"
                    [class.selected]="selectedNode?.id === node.id"
                    (click)="onNodeClick(node)">
                    <!-- Node circle -->
                    <circle
                        [attr.cx]="node.x + 20"
                        [attr.cy]="node.y + 20"
                        r="20"
                        [attr.fill]="getNodeColor(node.status)"
                        stroke="#fff"
                        stroke-width="2"
                        class="node-circle" />

                    <!-- Node icon -->
                    <text
                        [attr.x]="node.x + 20"
                        [attr.y]="node.y + 25"
                        text-anchor="middle"
                        fill="white"
                        font-size="14"
                        font-weight="bold">
                        A
                    </text>

                    <!-- Node label -->
                    <text
                        [attr.x]="node.x + 20"
                        [attr.y]="node.y + 55"
                        text-anchor="middle"
                        fill="#374151"
                        font-size="11">
                        {{ node.name }}
                    </text>

                    <!-- Power value -->
                    @if (node.value !== undefined) {
                        <text
                            [attr.x]="node.x + 20"
                            [attr.y]="node.y + 70"
                            text-anchor="middle"
                            fill="#6b7280"
                            font-size="10">
                            {{ node.value | number:'1.1-1' }} МВт
                        </text>
                    }
                </g>
            }
        </svg>

        <!-- Selected node details -->
        @if (selectedNode) {
            <div class="selected-node-info mt-4 p-3 bg-surface-100 rounded-lg">
                <h4 class="font-semibold mb-2">{{ selectedNode.name }}</h4>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div>
                        <span class="text-surface-500">{{ 'GES_DETAIL.MNEMONIC.STATUS' | translate }}:</span>
                        <span
                            class="ml-2 font-medium">{{ 'GES_DETAIL.STATUS.' + selectedNode.status.toUpperCase() | translate }}</span>
                    </div>
                    <div>
                        <span class="text-surface-500">{{ 'GES_DETAIL.MNEMONIC.POWER' | translate }}:</span>
                        <span class="ml-2 font-medium">{{ selectedNode.value | number:'1.2-2' }} МВт</span>
                    </div>
                </div>
            </div>
        }
    } @else {
        <!-- Placeholder when no data -->
        <div class="text-center py-16 text-surface-500">
            <i class="pi pi-sitemap text-6xl mb-4 block opacity-30"></i>
            <p>{{ 'GES_DETAIL.MNEMONIC.NO_DATA' | translate }}</p>
            <p class="text-sm mt-2">{{ 'GES_DETAIL.MNEMONIC.PLACEHOLDER' | translate }}</p>
        </div>
    }
</div>
