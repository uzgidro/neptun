<div class="sc-station-status neon-card">
    <div class="widget-title">
        <i class="pi pi-cog title-icon"></i>
        <span>Статус агрегатов</span>
    </div>

    <!-- Chart Container -->
    <div class="chart-container">
        <div class="chart-wrapper">
            <p-chart type="doughnut" [data]="chartData" [options]="chartOptions" [style]="{'width': '100%', 'height': '120px'}"></p-chart>
            <!-- Center Counter -->
            <div class="chart-center">
                <span class="center-value counter-digit">{{ totalUnits }}</span>
                <span class="center-label">Всего</span>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="status-legend">
        @for (status of statusData; track status.label) {
            <div class="legend-item">
                <div class="legend-indicator">
                    <span class="status-indicator" [class]="status.cssClass"></span>
                </div>
                <div class="legend-info">
                    <span class="legend-label">{{ status.label }}</span>
                    <div class="legend-stats">
                        <span class="legend-value">{{ status.value }}</span>
                        <span class="legend-percent">({{ getPercentage(status.value) }}%)</span>
                    </div>
                </div>
                <div class="legend-bar-container">
                    <div class="legend-bar"
                         [style.width.%]="getPercentage(status.value)"
                         [style.background]="status.color">
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Footer -->
    <div class="widget-footer">
        <span class="last-updated">Последнее обновление: {{ getTimeAgo() }}</span>
        <button class="refresh-btn" (click)="refresh()" [disabled]="loading">
            <i class="pi pi-refresh" [class.pi-spin]="loading"></i>
        </button>
    </div>
</div>
