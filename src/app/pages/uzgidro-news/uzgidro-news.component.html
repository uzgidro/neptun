<div class="card">
    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
        <div>
            <div class="font-semibold text-xl flex items-center gap-2">
                <i class="pi pi-globe text-primary"></i>
                {{ 'UZGIDRO_NEWS.TITLE' | translate }}
            </div>
            @if (meta()) {
                <div class="text-sm text-color-secondary mt-1">
                    {{ 'UZGIDRO_NEWS.TOTAL_NEWS' | translate }}: {{ meta()!.totalCount }}
                </div>
            }
        </div>
        @if (!loading()) {
            <p-tag [value]="(meta()?.totalCount || 0) + ' ' + ('UZGIDRO_NEWS.NEWS_COUNT' | translate)"
                   severity="info"></p-tag>
        }
    </div>

    <!-- Loading state with skeletons -->
    @if (loading()) {
        <div class="uzgidro-news-grid">
            @for (item of skeletonItems; track item) {
                <div class="news-card-wrapper">
                    <div class="news-card skeleton-card">
                        <p-skeleton height="200px" styleClass="mb-0"></p-skeleton>
                        <div class="news-card-content">
                            <p-skeleton width="100%" height="1.5rem" styleClass="mb-2"></p-skeleton>
                            <p-skeleton width="100%" height="3rem" styleClass="mb-3"></p-skeleton>
                            <div class="flex justify-between">
                                <p-skeleton width="100px" height="1rem"></p-skeleton>
                                <p-skeleton width="60px" height="1rem"></p-skeleton>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Empty state -->
    @if (!loading() && newsItems().length === 0) {
        <div class="flex flex-column items-center justify-center py-8">
            <i class="pi pi-inbox text-6xl text-gray-400 mb-3"></i>
            <p class="text-color-secondary mt-2">{{ 'UZGIDRO_NEWS.NO_NEWS' | translate }}</p>
        </div>
    }

    <!-- News grid -->
    @if (!loading() && newsItems().length > 0) {
        <div class="uzgidro-news-grid">
            @for (news of newsItems(); track news.id) {
                <div class="news-card-wrapper">
                    <div class="news-card" (click)="openDetailDialog(news)">
                        <!-- Image -->
                        <div class="news-card-image">
                            @if (news.img) {
                                <img [src]="getImageUrl(news.img)"
                                     [alt]="getTitle(news)"
                                     class="media-content"
                                     loading="lazy">
                            } @else {
                                <div class="news-card-placeholder">
                                    <i class="pi pi-image"></i>
                                </div>
                            }

                            <!-- UzGidro badge -->
                            <div class="uzgidro-badge">
                                <i class="pi pi-globe"></i>
                            </div>

                            <!-- Stats -->
                            <div class="news-card-stats">
                                <div class="stat-item" [pTooltip]="'UZGIDRO_NEWS.VIEWS' | translate">
                                    <i class="pi pi-eye"></i>
                                    <span>{{ formatViews(news.views) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="news-card-content">
                            <h3 class="news-card-title">{{ truncateText(getTitle(news), 80) }}</h3>
                            <p class="news-card-text">{{ truncateText(getSummary(news), 120) }}</p>

                            <div class="news-card-footer">
                                <div class="news-card-date">
                                    <i class="pi pi-calendar"></i>
                                    {{ formatDate(news.date) }}
                                </div>
                                <div class="news-card-id">
                                    <span class="text-xs text-color-secondary">#{{ news.id }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Pagination -->
    @if (!loading() && totalRecords() > rows()) {
        <p-paginator
            [first]="first"
            [rows]="rows()"
            [totalRecords]="totalRecords()"
            (onPageChange)="onPageChange($event)"
            [showCurrentPageReport]="true"
            [currentPageReportTemplate]="'UZGIDRO_NEWS.PAGE_REPORT' | translate">
        </p-paginator>
    }
</div>

<!-- Detail dialog -->
<p-dialog
    [(visible)]="displayDetailDialog"
    [header]="selectedNews() ? getTitle(selectedNews()!) : ''"
    [modal]="true"
    [dismissableMask]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{ width: '70vw', maxWidth: '900px' }"
    [breakpoints]="{ '960px': '90vw' }"
    styleClass="uzgidro-news-detail-dialog">

    @if (selectedNews()) {
        <!-- Stats header -->
        <div class="flex flex-wrap justify-between items-center mb-4 gap-3">
            <div class="flex gap-3">
                <div class="stat-badge">
                    <i class="pi pi-eye text-blue-500"></i>
                    <div>
                        <div class="text-xs text-color-secondary">{{ 'UZGIDRO_NEWS.VIEWS' | translate }}</div>
                        <div class="font-semibold">{{ selectedNews()!.views.toLocaleString() }}</div>
                    </div>
                </div>
            </div>
            <p-tag
                [value]="'#' + selectedNews()!.id"
                severity="info"
                [style]="{ fontSize: '0.875rem' }">
            </p-tag>
        </div>

        <!-- Image -->
        @if (selectedNews()!.img) {
            <div class="mb-4 text-center">
                <img [src]="getImageUrl(selectedNews()!.img)"
                     [alt]="getTitle(selectedNews()!)"
                     class="detail-image">
            </div>
        }

        <p-divider></p-divider>

        <!-- Full text content (HTML) -->
        <div class="news-content" [innerHTML]="getFullText(selectedNews()!)"></div>

        <p-divider></p-divider>

        <!-- Meta info -->
        <div class="flex flex-wrap gap-4 text-sm text-color-secondary">
            <div class="flex items-center gap-2">
                <i class="pi pi-calendar"></i>
                <span>{{ 'UZGIDRO_NEWS.PUBLISHED' | translate }}: {{ formatDateTime(selectedNews()!.date) }}</span>
            </div>
        </div>
    }

    <ng-template pTemplate="footer">
        <button pButton
                class="p-button-secondary"
                (click)="closeDetailDialog()">
            <span pButtonLabel>{{ 'COMMON.CLOSE' | translate }}</span>
            <i pButtonIcon class="pi pi-times"></i>
        </button>
    </ng-template>
</p-dialog>
